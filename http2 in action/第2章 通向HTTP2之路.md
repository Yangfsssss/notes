***第2章 通向HTTP/2之路***

​	本章要点

​	• 分析HTTP/1.1的性能问题

​	• 理解HTTP/1.1性能问题的变通解决办法

​	• 调研HTTP/1问题的实际解决案例

​	• SPDY是如何提升HTTP/1的

​	• SPDY如何被标准化为HTTP/2

​	• 在HTTP/2之下Web性能的改变

​	***2.1 HTTP/1.1和当前的万维网***

​		网页最初都是静态的页面，但随着Web的动态性变好，网页开始在服务端动态生成，例如使用CGI（Common Gateway Interface，公共网关接口）或Java Servlet/Java Server Page（JSP）动态生成。随后，从服务端生成完整页面变成只生成基本HTML页面，其他由客户端JavaScript进行AJAX（Asynchronous JavaScript and XML）调用。这些AJAX调用向Web服务器发出额外请求，以更改网页内容，而无须重新加载整页或要求在服务端动态生成基本映像。

​		HTTP协议在设计之初并未考虑到资源的这种巨量增长，协议的简单性设计不可避免地遇到了一些根本上的性能问题。

​		***HTTP/1.1根本的性能问题***

​		现代互联网最大的问题之一是延迟而不是带宽。延迟是将单个消息发送到服务器所需的时间，而带宽是指用户可以在这些消息中下载多少内容。

​		发送和接收HTTP消息时浪费了太多时间，尽管这些消息可能很小。

​		***HTTP/1.1管道化***

​		管道化技术应该会对HTTP带来巨大的性能改善，但由于多种原因，它很难实现，易于出错，并且没有获得Web浏览器和Web服务器的良好支持。

​		***网络性能瀑布流图***

​		对于大量的资源，瀑布图比流程图更容易阅读。

​	***2.2 解决HTTP/1.1性能问题的方案***

​		随着时间的推移，已经有各种突破HTTP/1.1的性能限制的技术，这些技术分为以下两类：

​		• 使用多个HTTP连接。

​		• 合并HTTP请求。

​		《Web Performance in Action》

​		***使用多个HTTP连接***

​		开启多个TCP连接并不是解决HTTP/1问题的满意方案，尽管在没有更好的解决方案时，它确实可以提升性能。

​		***发送更少的请求***

​		这个方案的主要问题是它引入的复杂度。创建精灵图需要额外的操作，通过独立的文件来提供图片更简单。不是所有的网站都有做优化（如合并CSS文件）的自动化工作流。

​		***HTTP/1性能优化总结***

​		应该有更好的办法在协议层面解决这个问题，从而节省时间，这正是HTTP/2要做的。

​	***2.3 HTTP/1.1的其他问题***

​		尽管HTTP消息体可以包含二进制数据（比如图片，以及客户端和服务器能理解的任何格式），但请求和首部需要是文本的形式。HTTP文本消息处理起来很复杂，且容易出错，会导致安全问题。

​		另外一个问题是，HTTP消息较大，这是因为不能高效编码数据（比如使用数字来表达Date首部，而不是使用人类可读的完整文本），而且首部内容也有重复。

​		性能问题是HTTP/1.1需要改善的其中一个问题。除此之外，它还存在纯文本协议的安全和隐私问题（HTTPS加密很好地解决了这个问题），以及缺少状态的问题（cookie在一定程度上解决了这个问题）。

​	***2.4 实际案例***

​		***2.4.1 示例网站1:amazon.com***

​		***2.4.1 示例网站2:imgur.com***

​		***2.4.3 这个问题究竟有多严重***

​		虽然存在一些变通的解决方案，但是，这些解决方案并不完善。为此，需要花时间和资金，需要理解如何实现、如何维护，而且它本身也有性能问题。开发的成本并不便宜，花时间兼容一个效率低下的协议虽然有必要，但是成本高昂（更不用说，很多网站没意识到他们网站性能对他们的影响）。很多研究表明，网站缓慢会导致用户离开，订单减少。

​		很多网站清楚地知道HTTP协议对网站性能的影响，所以他们实现了一些优化HTTP/1.1性能的方法。但是因为这些方法复杂且难以理解，所以很多其他的网站没有实现。另外一个问题是，这些解决方案也有一些限制。这些方案本身也会引入低效率的因素，随着网站内容和复杂度的增加，最终这些变通的解决方案也会失效。

​		总体来说，每个网站都是不一样的，每个站长或者Web开发者都要花时间分析网站本身的性能瓶颈，并使用瀑布图之类的工具，查明网站受到HTTP/1.1性能问题的影响有多大。

​	***2.5 从HTTP/1.1到HTTP/2***

​		***SPDY***

​		***HTTP/2***

​		HTTP/2已经在实际应用中得到验证，可以显著提高性能，而且它解决了本章中描述的HTTP/1.1的问题。

​	***2.6 HTTP/2对Web性能的影响***

​		***展示HTTP/2能力的绝佳示例***

​		https://www.httpvshttps.com/

​		***对HTTP/2提升性能的期望***

​		***HTTP/1.1的一些性能变通方法可能是反模式***

​		许多人认为这些变通办法正在成为HTTP/2世界的反模式，因为它们可能会降低使用HTTP/2的效果。

​		在客户端，尽管有强大的浏览器支持，一些用户仍会使用HTTP/1.1。他们可能正在使用较旧的浏览器，或通过尚不支持HTTP/2的代理（包括防病毒扫描程序和公司代理）进行连接。

​	***总结***

​		• HTTP/1.1存在一些根本的性能问题，特别是在获取多个资源时。

​		• 对于这些性能问题有多种变通的解决方法（使用多个连接、域名分片，以及使用精灵图等），但它们有其自身的缺点。

​		• 可以通过WebPagetest等工具生成瀑布图，从中很容易看到性能问题。

​		• SDPY旨在解决这些性能问题。

​		• HTTP/2是SPDY的标准化版本。

​		• 并非所有性能问题都可以通过HTTP/2解决。

​	



